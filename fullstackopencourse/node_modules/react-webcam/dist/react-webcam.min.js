!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):"object"==typeof exports?exports.Webcam=t(require("react"),require("prop-types")):e.Webcam=t(e.React,e.PropTypes)}(this,function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){var n,o,i;o=[t,r(1),r(2)],void 0===(i="function"==typeof(n=function(r,n,o){"use strict";function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(n);var p,h=(p=o,o=p&&p.__esModule?p:{default:p}).default.oneOfType([o.default.string,o.default.arrayOf(o.default.string),o.default.shape({exact:o.default.oneOfType([o.default.string,o.default.arrayOf(o.default.string)])}),o.default.shape({ideal:o.default.oneOfType([o.default.string,o.default.arrayOf(o.default.string)])})]),v=o.default.oneOfType([o.default.shape({exact:o.default.bool}),o.default.shape({ideal:o.default.bool})]),y=o.default.oneOfType([o.default.number,o.default.shape({exact:o.default.number,ideal:o.default.number,min:o.default.number,max:o.default.number})]),m=y,g=o.default.shape({deviceId:h,groupId:h,autoGainControl:v,channelCount:y,latency:m,noiseSuppression:v,sampleRate:y,sampleSize:y,volume:m}),b=o.default.shape({deviceId:h,groupId:h,aspectRatio:m,facingMode:h,frameRate:m,height:y,width:y}),O={audio:o.default.bool,onUserMedia:o.default.func,onUserMediaError:o.default.func,screenshotFormat:o.default.oneOf(["image/webp","image/png","image/jpeg"]),screenshotQuality:o.default.number,minScreenshotWidth:o.default.number,minScreenshotHeight:o.default.number,audioConstraints:g,videoConstraints:b,imageSmoothing:o.default.bool},M=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=d(this,f(t).call(this))).state={hasUserMedia:!1},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,e),r=t,(o=[{key:"componentDidMount",value:function(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia){var e=this.state;t.mountedInstances.push(this),e.hasUserMedia||t.userMediaRequested||this.requestUserMedia()}}},{key:"componentDidUpdate",value:function(e){var t=this.props;JSON.stringify(e.audioConstraints)===JSON.stringify(t.audioConstraints)&&JSON.stringify(e.videoConstraints)===JSON.stringify(t.videoConstraints)||this.requestUserMedia()}},{key:"componentWillUnmount",value:function(){var e=this.state,r=t.mountedInstances.indexOf(this);t.mountedInstances.splice(r,1),t.userMediaRequested=!1,0===t.mountedInstances.length&&e.hasUserMedia&&(this.stream.getVideoTracks&&this.stream.getAudioTracks?(this.stream.getVideoTracks().map(function(e){return e.stop()}),this.stream.getAudioTracks().map(function(e){return e.stop()})):this.stream.stop(),window.URL.revokeObjectURL(e.src))}},{key:"getScreenshot",value:function(){var e=this.state,t=this.props;if(!e.hasUserMedia)return null;var r=this.getCanvas();return r&&r.toDataURL(t.screenshotFormat,t.screenshotQuality)}},{key:"getCanvas",value:function(){var e=this.state,t=this.props;if(!e.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var r=document.createElement("canvas"),n=this.video.videoWidth/this.video.videoHeight,o=t.minScreenshotWidth||this.video.clientWidth,i=o/n;t.minScreenshotHeight&&i<t.minScreenshotHeight&&(i=t.minScreenshotHeight,o=i*n),r.width=o,r.height=i,this.canvas=r,this.ctx=r.getContext("2d")}var a=this.ctx,u=this.canvas;return a.imageSmoothingEnabled=t.imageSmoothing,a.drawImage(this.video,0,0,u.width,u.height),u}},{key:"requestUserMedia",value:function(){var e=this.props;navigator.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var r=function(r,n){var o={video:void 0===n||n};e.audio&&(o.audio=void 0===r||r),navigator.mediaDevices.getUserMedia(o).then(function(e){t.mountedInstances.forEach(function(t){return t.handleUserMedia(null,e)})}).catch(function(e){t.mountedInstances.forEach(function(t){return t.handleUserMedia(e)})})};if("mediaDevices"in navigator)r(e.audioConstraints,e.videoConstraints);else{var n=function(e){return{optional:[{sourceId:e}]}},o=function(e){var t=e||{},r=t.deviceId;return"string"==typeof r?r:Array.isArray(r)&&r.length>0?r[0]:"object"===s(r)&&r.ideal?r.ideal:null};MediaStreamTrack.getSources(function(t){var i=null,a=null;t.forEach(function(e){"audio"===e.kind?i=e.id:"video"===e.kind&&(a=e.id)});var u=o(e.audioConstraints);u&&(i=u);var s=o(e.videoConstraints);s&&(a=s),r(n(i),n(a))})}t.userMediaRequested=!0}},{key:"handleUserMedia",value:function(e,t){var r=this.props;if(e)return this.setState({hasUserMedia:!1}),void r.onUserMediaError(e);this.stream=t;try{this.video.srcObject=t,this.setState({hasUserMedia:!0})}catch(e){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}r.onUserMedia()}},{key:"render",value:function(){var e=this,t=this.state,r=this.props,o=Object.entries(r).reduce(function(e,t){var r=u(t,2),n=r[0],o=r[1];return Object.prototype.hasOwnProperty.call(O,n)?e:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){a(e,t,r[t])})}return e}({},e,a({},n,o))},{});return n.default.createElement("video",i({autoPlay:!0,src:t.src,muted:r.audio,playsInline:!0,ref:function(t){e.video=t}},o))}}])&&c(r.prototype,o),p&&c(r,p),t;var r,o,p}(n.Component);r.default=M,M.defaultProps={audio:!0,imageSmoothing:!0,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},M.propTypes=O,M.mountedInstances=[],M.userMediaRequested=!1,e.exports=t.default})?n.apply(t,o):n)||(e.exports=i)},function(t,r){t.exports=e},function(e,r){e.exports=t}])});